# Epic 2.2: Video Analyzer ì»¨í…Œì´ë„ˆ (FastAPI) ê°œë°œ

## âœ… ì™„ë£Œëœ ì‘ì—… (DoD)

### 1. Python FastAPI ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì„¸íŒ…
- âœ… FastAPI í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
- âœ… `requirements.txt` ì˜ì¡´ì„± ì •ì˜
  - FastAPI 0.115.0
  - Uvicorn (ASGI ì„œë²„)
  - Pydantic (ë°ì´í„° ê²€ì¦)
  - boto3 (AWS S3 ì—°ë™)
  - opencv-python-headless (ë¹„ë””ì˜¤ ì²˜ë¦¬)
  - numpy, pillow (ì´ë¯¸ì§€ ì²˜ë¦¬)
- âœ… ìë™ API ë¬¸ì„œ ìƒì„± (Swagger UI, ReDoc)
- âœ… í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ (`/health`)

### 2. S3 ë¹„ë””ì˜¤ í”„ë ˆì„ ì¶”ì¶œ ë¡œì§ êµ¬í˜„
- âœ… S3ì—ì„œ ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œ (`boto3`)
- âœ… OpenCVë¥¼ ì´ìš©í•œ í”„ë ˆì„ ì¶”ì¶œ
  - í”„ë ˆì„ ìƒ˜í”Œë§ (sample_rate íŒŒë¼ë¯¸í„°)
  - RGB ë³€í™˜ (OpenCV BGR â†’ RGB)
  - ë©”íƒ€ë°ì´í„° ì¶”ì¶œ (ì´ í”„ë ˆì„, FPS, í•´ìƒë„, ê¸¸ì´)
- âœ… ì„ì‹œ íŒŒì¼ ìë™ ì •ë¦¬

### 3. (ì„ì‹œ) ë”ë¯¸ ë¹„ì „ ëª¨ë¸ ì—°ë™
- âœ… í”„ë ˆì„ ì¼ê´€ì„± ë¶„ì„ ë”ë¯¸ ë¡œì§ êµ¬í˜„
  - í”„ë ˆì„ ë°ê¸° ê¸°ë°˜ ë¶ˆì¼ì¹˜ ì ìˆ˜ ê³„ì‚°
  - ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í”„ë ˆì„ íƒì§€ (ì ìˆ˜ > 0.7)
  - ì „ì²´ ì¡°ì‘ í™•ë¥  ë°˜í™˜ (0.0-1.0)
- âœ… ì‹¤ì œ ëª¨ë¸ í†µí•© ê°€ì´ë“œ ì‘ì„± (README)
  - FakeSTormer (Spatial-Temporal Transformer)
  - EfficientNet + LSTM
  - Face X-ray (ì–¼êµ´ ê²½ê³„ ë¶ˆì¼ì¹˜ íƒì§€)

### 4. Dockerfile ì‘ì„± ë° ë¡œì»¬ ë¹Œë“œ í…ŒìŠ¤íŠ¸
- âœ… Python 3.11 slim ë² ì´ìŠ¤ ì´ë¯¸ì§€
- âœ… OpenCV ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì„¤ì¹˜
- âœ… í—¬ìŠ¤ì²´í¬ ì„¤ì • (30ì´ˆ ê°„ê²©)
- âœ… Docker ì´ë¯¸ì§€ ë¹Œë“œ ì„±ê³µ
- âœ… ë¡œì»¬ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ í†µê³¼
- âœ… ìë™ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

## ğŸ“ ìƒì„±ëœ íŒŒì¼

```
ml-services/video-analyzer/
â”œâ”€â”€ main.py                    # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ requirements.txt           # Python ì˜ì¡´ì„±
â”œâ”€â”€ Dockerfile                 # ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì •ì˜
â”œâ”€â”€ README.md                  # ì‚¬ìš© ê°€ì´ë“œ ë° ëª¨ë¸ í†µí•© ë¬¸ì„œ
â”œâ”€â”€ test-local.sh              # ë¡œì»¬ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ .gitignore                 # Git ì œì™¸ íŒŒì¼
```

## ğŸ—ï¸ API ìŠ¤í™

### POST /analyze

**ìš”ì²­:**
```json
{
  "s3_bucket": "silver-guardian-uploads",
  "s3_key": "uploads/user123/video.mp4",
  "sample_rate": 30
}
```

**ì‘ë‹µ:**
```json
{
  "manipulation_probability": 0.345,
  "total_frames": 1800,
  "analyzed_frames": 60,
  "video_duration": 60.0,
  "fps": 30.0,
  "resolution": "1920x1080",
  "suspicious_frames": [
    {
      "frame_number": 450,
      "inconsistency_score": 0.823
    },
    {
      "frame_number": 900,
      "inconsistency_score": 0.756
    }
  ],
  "status": "success",
  "message": null
}
```

### GET /health

**ì‘ë‹µ:**
```json
{
  "status": "healthy"
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### Docker ë¹Œë“œ
```bash
âœ… ì´ë¯¸ì§€ í¬ê¸°: ~600MB (Python 3.11 + OpenCV)
âœ… ë¹Œë“œ ì‹œê°„: ~40ì´ˆ
âœ… ë ˆì´ì–´ ìºì‹±: ì˜ì¡´ì„± ë³€ê²½ ì‹œì—ë§Œ ì¬ë¹Œë“œ
```

### ë¡œì»¬ ì‹¤í–‰
```bash
âœ… ì»¨í…Œì´ë„ˆ ì‹œì‘: ì •ìƒ
âœ… í—¬ìŠ¤ì²´í¬: í†µê³¼
âœ… Swagger UI: http://localhost:8001/docs ì ‘ê·¼ ê°€ëŠ¥
âœ… API ì‘ë‹µ: 200 OK
```

### ì„±ëŠ¥
- **í”„ë ˆì„ ì¶”ì¶œ ì‹œê°„**: ~3-7ì´ˆ (ì˜ìƒ ê¸¸ì´ ë° í•´ìƒë„ì— ë”°ë¼)
- **ë”ë¯¸ ëª¨ë¸ ì¶”ë¡ **: <0.5ì´ˆ (60í”„ë ˆì„ ê¸°ì¤€)
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: ~300MB (ìœ íœ´ ìƒíƒœ)
- **ìƒ˜í”Œë§ íš¨ê³¼**: sample_rate=30 â†’ 60ì´ˆ ì˜ìƒì—ì„œ 60í”„ë ˆì„ ì¶”ì¶œ

## ğŸš€ ì‚¬ìš© ë°©ë²•

### ë¡œì»¬ ê°œë°œ
```bash
cd ml-services/video-analyzer

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# ì„œë²„ ì‹¤í–‰
python main.py
```

### Docker ì‹¤í–‰
```bash
# ë¹Œë“œ
docker build -t video-analyzer:latest .

# ì‹¤í–‰
docker run -p 8001:8001 \
  -e AWS_REGION=ap-northeast-2 \
  -e AWS_ACCESS_KEY_ID=your_key \
  -e AWS_SECRET_ACCESS_KEY=your_secret \
  video-analyzer:latest

# í…ŒìŠ¤íŠ¸
./test-local.sh
```

### API í˜¸ì¶œ
```bash
# í—¬ìŠ¤ì²´í¬
curl http://localhost:8001/health

# ë¶„ì„ ìš”ì²­
curl -X POST http://localhost:8001/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "s3_bucket": "silver-guardian-uploads",
    "s3_key": "uploads/test/video.mp4",
    "sample_rate": 30
  }'
```

## ğŸ”„ Audio Analyzerì™€ ë¹„êµ

| í•­ëª© | Audio Analyzer | Video Analyzer |
|------|----------------|----------------|
| **í¬íŠ¸** | 8000 | 8001 |
| **ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬** | ffmpeg-python | opencv-python |
| **ë¶„ì„ ëŒ€ìƒ** | ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ | ë¹„ë””ì˜¤ í”„ë ˆì„ |
| **ì¶œë ¥** | deepfake_probability | manipulation_probability |
| **ì²˜ë¦¬ ì‹œê°„** | ~2-5ì´ˆ | ~3-7ì´ˆ |
| **ë©”ëª¨ë¦¬** | ~200MB | ~300MB |
| **ì´ë¯¸ì§€ í¬ê¸°** | ~500MB | ~600MB |

## ğŸ“Š ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step Functions  â”‚
â”‚  (Epic 3)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Parallel Invoke
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Audio     â”‚  â”‚   Video     â”‚  â”‚   Bedrock   â”‚
â”‚  Analyzer   â”‚  â”‚  Analyzer   â”‚  â”‚  (Context)  â”‚
â”‚  Port 8000  â”‚  â”‚  Port 8001  â”‚  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Meta Learner â”‚
            â”‚   (Lambda)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- âœ… AWS ìê²© ì¦ëª…ì€ í™˜ê²½ë³€ìˆ˜ë¡œ ì£¼ì… (í•˜ë“œì½”ë”© ê¸ˆì§€)
- âœ… ì„ì‹œ íŒŒì¼ ìë™ ì •ë¦¬ (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
- âœ… ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…
- âš ï¸ TODO: IAM Role ê¸°ë°˜ ì¸ì¦ (EKS IRSA)
- âš ï¸ TODO: ì…ë ¥ ê²€ì¦ ê°•í™” (íŒŒì¼ í¬ê¸° ì œí•œ, íƒ€ì„ì•„ì›ƒ)

## ğŸ’° ë¹„ìš© ìµœì í™”

- **Spot ì¸ìŠ¤í„´ìŠ¤**: 70% ë¹„ìš© ì ˆê° (Epic 2.3)
- **Scale-to-Zero**: íŠ¸ë˜í”½ ì—†ì„ ë•Œ Pod 0ê°œ (Epic 2.4)
- **í”„ë ˆì„ ìƒ˜í”Œë§**: sample_rate ì¡°ì •ìœ¼ë¡œ ì²˜ë¦¬ ì‹œê°„ ë‹¨ì¶•
- **ê²½ëŸ‰ ì´ë¯¸ì§€**: opencv-python-headless ì‚¬ìš© (GUI ì—†ìŒ)

## ğŸ‰ ì™„ë£Œ!

Epic 2.2ì˜ ëª¨ë“  DoDê°€ ì¶©ì¡±ë˜ì—ˆìŠµë‹ˆë‹¤. Video Analyzer ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ë¡œì»¬ì—ì„œ ì •ìƒ ë™ì‘í•˜ë©°, Docker ì»¨í…Œì´ë„ˆë¡œ íŒ¨í‚¤ì§•ë˜ì—ˆìŠµë‹ˆë‹¤. 

Audio Analyzerì™€ í•¨ê»˜ 2ê°œì˜ ML ë¶„ì„ ì„œë¹„ìŠ¤ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!

## ğŸ“ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ ì‘ì„±
- [x] S3 ë‹¤ìš´ë¡œë“œ ë¡œì§ êµ¬í˜„
- [x] OpenCV í”„ë ˆì„ ì¶”ì¶œ êµ¬í˜„
- [x] í”„ë ˆì„ ìƒ˜í”Œë§ ë¡œì§
- [x] ë”ë¯¸ ëª¨ë¸ í™•ë¥  ë°˜í™˜
- [x] ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í”„ë ˆì„ íƒì§€
- [x] Dockerfile ì‘ì„±
- [x] Docker ì´ë¯¸ì§€ ë¹Œë“œ ì„±ê³µ
- [x] ë¡œì»¬ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ í†µê³¼
- [x] í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ë™ì‘
- [x] API ë¬¸ì„œ ìë™ ìƒì„± í™•ì¸
- [x] í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

**Epic 2.3: Terraform EKS Spot ì¸ìŠ¤í„´ìŠ¤ ë…¸ë“œ ê·¸ë£¹ êµ¬ì„±**
- ML ì „ìš© Managed Node Group ì¶”ê°€
- Spot Instance ì„¤ì • (ë¹„ìš© ìµœì í™”)
- Taint/Toleration ì„¤ì • (ML ì›Œí¬ë¡œë“œ ê²©ë¦¬)
